<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DatabricksPreparedStatement.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">com.databricks.jdbc.core</a> &gt; <span class="el_source">DatabricksPreparedStatement.java</span></div><h1>DatabricksPreparedStatement.java</h1><pre class="source lang-java linenums">package com.databricks.jdbc.core;

import static com.databricks.jdbc.core.DatabricksTypeUtil.*;

import com.databricks.jdbc.client.StatementType;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.Reader;
import java.math.BigDecimal;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.sql.*;
import java.sql.Date;
import java.util.*;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

public class DatabricksPreparedStatement extends DatabricksStatement implements PreparedStatement {

<span class="fc" id="L21">  private static final Logger LOGGER = LogManager.getLogger(DatabricksPreparedStatement.class);</span>
  private final String sql;
  private final Map&lt;Integer, ImmutableSqlParameter&gt; parameterBindings;

<span class="fc" id="L25">  private final int CHUNK_SIZE = 8192;</span>

  public DatabricksPreparedStatement(DatabricksConnection connection, String sql) {
<span class="fc" id="L28">    super(connection);</span>
<span class="fc" id="L29">    this.sql = sql;</span>
<span class="fc" id="L30">    this.parameterBindings = new HashMap&lt;Integer, ImmutableSqlParameter&gt;();</span>
<span class="fc" id="L31">  }</span>

  private void checkLength(int targetLength, int sourceLength) throws SQLException {
<span class="pc bpc" id="L34" title="1 of 2 branches missed.">    if (targetLength != sourceLength) {</span>
<span class="nc" id="L35">      String errorMessage =</span>
<span class="nc" id="L36">          String.format(</span>
              &quot;Unexpected number of bytes read from the stream. Expected: %d, got: %d&quot;,
<span class="nc" id="L38">              targetLength, sourceLength);</span>
<span class="nc" id="L39">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L40">      throw new DatabricksSQLException(errorMessage);</span>
    }
<span class="fc" id="L42">  }</span>

  private void checkLength(long targetLength, long sourceLength) throws SQLException {
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">    if (targetLength != sourceLength) {</span>
<span class="nc" id="L46">      String errorMessage =</span>
<span class="nc" id="L47">          String.format(</span>
              &quot;Unexpected number of bytes read from the stream. Expected: %d, got: %d&quot;,
<span class="nc" id="L49">              targetLength, sourceLength);</span>
<span class="nc" id="L50">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L51">      throw new DatabricksSQLException(errorMessage);</span>
    }
<span class="fc" id="L53">  }</span>

  private byte[] readByteStream(InputStream x, int length) throws SQLException {
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">    if (x == null) {</span>
<span class="nc" id="L57">      String errorMessage = &quot;InputStream cannot be null&quot;;</span>
<span class="nc" id="L58">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L59">      throw new DatabricksSQLException(errorMessage);</span>
    }
<span class="fc" id="L61">    byte[] bytes = new byte[length];</span>
    try {
<span class="fc" id="L63">      int bytesRead = x.read(bytes);</span>
<span class="fc" id="L64">      checkLength(bytesRead, length);</span>
<span class="nc" id="L65">    } catch (IOException e) {</span>
<span class="nc" id="L66">      String errorMessage = &quot;Error reading from the InputStream&quot;;</span>
<span class="nc" id="L67">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L68">      throw new DatabricksSQLException(errorMessage, e);</span>
<span class="fc" id="L69">    }</span>
<span class="fc" id="L70">    return bytes;</span>
  }

  @Override
  public ResultSet executeQuery() throws SQLException {
<span class="fc" id="L75">    LOGGER.debug(&quot;public ResultSet executeQuery()&quot;);</span>
<span class="fc" id="L76">    return executeInternal(sql, parameterBindings, StatementType.QUERY);</span>
  }

  @Override
  public int executeUpdate() throws SQLException {
<span class="fc" id="L81">    LOGGER.debug(&quot;public int executeUpdate()&quot;);</span>
<span class="fc" id="L82">    executeInternal(sql, parameterBindings, StatementType.UPDATE);</span>
<span class="fc" id="L83">    return (int) resultSet.getUpdateCount();</span>
  }

  @Override
  public void setNull(int parameterIndex, int sqlType) throws SQLException {
<span class="nc" id="L88">    LOGGER.debug(&quot;public void setNull(int parameterIndex, int sqlType)&quot;);</span>
<span class="nc" id="L89">    setObject(parameterIndex, null, sqlType);</span>
<span class="nc" id="L90">  }</span>

  @Override
  public void setBoolean(int parameterIndex, boolean x) throws SQLException {
<span class="fc" id="L94">    LOGGER.debug(&quot;public void setBoolean(int parameterIndex, boolean x)&quot;);</span>
<span class="fc" id="L95">    checkIfClosed();</span>
<span class="fc" id="L96">    setObject(parameterIndex, x, DatabricksTypeUtil.BOOLEAN);</span>
<span class="fc" id="L97">  }</span>

  @Override
  public void setByte(int parameterIndex, byte x) throws SQLException {
<span class="fc" id="L101">    LOGGER.debug(&quot;public void setByte(int parameterIndex, byte x)&quot;);</span>
<span class="fc" id="L102">    checkIfClosed();</span>
<span class="fc" id="L103">    setObject(parameterIndex, x, DatabricksTypeUtil.TINYINT);</span>
<span class="fc" id="L104">  }</span>

  @Override
  public void setShort(int parameterIndex, short x) throws SQLException {
<span class="fc" id="L108">    LOGGER.debug(&quot;public void setShort(int parameterIndex, short x)&quot;);</span>
<span class="fc" id="L109">    checkIfClosed();</span>
<span class="fc" id="L110">    setObject(parameterIndex, x, DatabricksTypeUtil.SMALLINT);</span>
<span class="fc" id="L111">  }</span>

  @Override
  public void setInt(int parameterIndex, int x) throws SQLException {
<span class="fc" id="L115">    LOGGER.debug(&quot;public void setInt(int parameterIndex, int x)&quot;);</span>
<span class="fc" id="L116">    checkIfClosed();</span>
<span class="fc" id="L117">    setObject(parameterIndex, x, DatabricksTypeUtil.INT);</span>
<span class="fc" id="L118">  }</span>

  @Override
  public void setLong(int parameterIndex, long x) throws SQLException {
<span class="fc" id="L122">    LOGGER.debug(&quot;public void setLong(int parameterIndex, long x)&quot;);</span>
<span class="fc" id="L123">    checkIfClosed();</span>
<span class="fc" id="L124">    setObject(parameterIndex, x, DatabricksTypeUtil.BIGINT);</span>
<span class="fc" id="L125">  }</span>

  @Override
  public void setFloat(int parameterIndex, float x) throws SQLException {
<span class="fc" id="L129">    LOGGER.debug(&quot;public void setFloat(int parameterIndex, float x)&quot;);</span>
<span class="fc" id="L130">    checkIfClosed();</span>
<span class="fc" id="L131">    setObject(parameterIndex, x, DatabricksTypeUtil.FLOAT);</span>
<span class="fc" id="L132">  }</span>

  @Override
  public void setDouble(int parameterIndex, double x) throws SQLException {
<span class="fc" id="L136">    LOGGER.debug(&quot;public void setDouble(int parameterIndex, double x)&quot;);</span>
<span class="fc" id="L137">    checkIfClosed();</span>
<span class="fc" id="L138">    setObject(parameterIndex, x, DatabricksTypeUtil.DOUBLE);</span>
<span class="fc" id="L139">  }</span>

  @Override
  public void setBigDecimal(int parameterIndex, BigDecimal x) throws SQLException {
<span class="fc" id="L143">    LOGGER.debug(&quot;public void setBigDecimal(int parameterIndex, BigDecimal x)&quot;);</span>
<span class="fc" id="L144">    checkIfClosed();</span>
<span class="fc" id="L145">    setObject(parameterIndex, x, DatabricksTypeUtil.DECIMAL);</span>
<span class="fc" id="L146">  }</span>

  @Override
  public void setString(int parameterIndex, String x) throws SQLException {
<span class="fc" id="L150">    LOGGER.debug(&quot;public void setString(int parameterIndex, String x)&quot;);</span>
<span class="fc" id="L151">    checkIfClosed();</span>
<span class="fc" id="L152">    setObject(parameterIndex, x, DatabricksTypeUtil.STRING);</span>
<span class="fc" id="L153">  }</span>

  @Override
  public void setBytes(int parameterIndex, byte[] x) throws SQLException {
<span class="fc" id="L157">    LOGGER.debug(&quot;public void setBytes(int parameterIndex, byte[] x)&quot;);</span>
<span class="fc" id="L158">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setBytes(int parameterIndex, byte[] x)&quot;);
  }

  @Override
  public void setDate(int parameterIndex, Date x) throws SQLException {
<span class="fc" id="L164">    LOGGER.debug(&quot;public void setDate(int parameterIndex, Date x)&quot;);</span>
<span class="fc" id="L165">    checkIfClosed();</span>
<span class="fc" id="L166">    setObject(parameterIndex, x, DatabricksTypeUtil.DATE);</span>
<span class="fc" id="L167">  }</span>

  @Override
  public void setTime(int parameterIndex, Time x) throws SQLException {
<span class="fc" id="L171">    LOGGER.debug(&quot;public void setTime(int parameterIndex, Time x)&quot;);</span>
<span class="fc" id="L172">    checkIfClosed();</span>
<span class="fc" id="L173">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setTime(int parameterIndex, Time x)&quot;);
  }

  @Override
  public void setTimestamp(int parameterIndex, Timestamp x) throws SQLException {
<span class="fc" id="L179">    LOGGER.debug(&quot;public void setTimestamp(int parameterIndex, Timestamp x)&quot;);</span>
<span class="fc" id="L180">    checkIfClosed();</span>
<span class="fc" id="L181">    setObject(parameterIndex, x, DatabricksTypeUtil.TIMESTAMP);</span>
<span class="fc" id="L182">  }</span>

  @Override
  public void setAsciiStream(int parameterIndex, InputStream x, int length) throws SQLException {
<span class="fc" id="L186">    LOGGER.debug(&quot;public void setAsciiStream(int parameterIndex, InputStream x, int length)&quot;);</span>
<span class="fc" id="L187">    checkIfClosed();</span>
<span class="fc" id="L188">    byte[] bytes = readByteStream(x, length);</span>
<span class="fc" id="L189">    String asciiString = new String(bytes, StandardCharsets.US_ASCII);</span>
<span class="fc" id="L190">    setObject(parameterIndex, asciiString, DatabricksTypeUtil.STRING);</span>
<span class="fc" id="L191">  }</span>

  @Override
  public void setUnicodeStream(int parameterIndex, InputStream x, int length) throws SQLException {
<span class="fc" id="L195">    LOGGER.debug(&quot;public void setUnicodeStream(int parameterIndex, InputStream x, int length)&quot;);</span>
<span class="fc" id="L196">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setUnicodeStream(int parameterIndex, InputStream x, int length)&quot;);
  }

  @Override
  public void setBinaryStream(int parameterIndex, InputStream x, int length) throws SQLException {
<span class="fc" id="L202">    LOGGER.debug(&quot;public void setBinaryStream(int parameterIndex, InputStream x, int length)&quot;);</span>
<span class="fc" id="L203">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setBinaryStream(int parameterIndex, InputStream x, int length)&quot;);
  }

  @Override
  public void clearParameters() throws SQLException {
<span class="nc" id="L209">    LOGGER.debug(&quot;public void clearParameters()&quot;);</span>
<span class="nc" id="L210">    checkIfClosed();</span>
<span class="nc" id="L211">    this.parameterBindings.clear();</span>
<span class="nc" id="L212">  }</span>

  @Override
  public void setObject(int parameterIndex, Object x, int targetSqlType) throws SQLException {
<span class="nc" id="L216">    LOGGER.debug(&quot;public void setObject(int parameterIndex, Object x, int targetSqlType)&quot;);</span>
<span class="nc" id="L217">    checkIfClosed();</span>
<span class="nc" id="L218">    String databricksType = getDatabricksTypeFromSQLType(targetSqlType);</span>
<span class="nc bnc" id="L219" title="All 2 branches missed.">    if (databricksType != null) {</span>
<span class="nc" id="L220">      setObject(parameterIndex, x, databricksType);</span>
<span class="nc" id="L221">      return;</span>
    }
    // TODO: handle other types
<span class="nc" id="L224">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setObject(int parameterIndex, Object x, int targetSqlType)&quot;);
  }

  @Override
  public void setObject(int parameterIndex, Object x) throws SQLException {
<span class="nc" id="L230">    LOGGER.debug(&quot;public void setObject(int parameterIndex, Object x)&quot;);</span>
<span class="nc" id="L231">    checkIfClosed();</span>
<span class="nc" id="L232">    String type = inferDatabricksType(x);</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">    if (type != null) {</span>
<span class="nc" id="L234">      setObject(parameterIndex, x, type);</span>
<span class="nc" id="L235">      return;</span>
    }
    // TODO: handle other types and generic objects
<span class="nc" id="L238">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setObject(int parameterIndex, Object x)&quot;);
  }

  private void setObject(int parameterIndex, Object x, String databricksType) {
<span class="fc" id="L243">    this.parameterBindings.put(</span>
<span class="fc" id="L244">        parameterIndex,</span>
<span class="fc" id="L245">        ImmutableSqlParameter.builder()</span>
<span class="fc" id="L246">            .type(databricksType)</span>
<span class="fc" id="L247">            .value(x)</span>
<span class="fc" id="L248">            .cardinal(parameterIndex)</span>
<span class="fc" id="L249">            .build());</span>
<span class="fc" id="L250">  }</span>

  @Override
  public boolean execute() throws SQLException {
<span class="nc" id="L254">    LOGGER.debug(&quot;public boolean execute()&quot;);</span>
<span class="nc" id="L255">    checkIfClosed();</span>
<span class="nc" id="L256">    executeInternal(sql, parameterBindings, StatementType.SQL);</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">    return !resultSet.hasUpdateCount();</span>
  }

  @Override
  public void addBatch() throws SQLException {
<span class="fc" id="L262">    LOGGER.debug(&quot;public void addBatch()&quot;);</span>
<span class="fc" id="L263">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - addBatch()&quot;);
  }

  @Override
  public void setCharacterStream(int parameterIndex, Reader reader, int length)
      throws SQLException {
<span class="fc" id="L270">    LOGGER.debug(&quot;public void setCharacterStream(int parameterIndex, Reader reader, int length)&quot;);</span>
<span class="fc" id="L271">    checkIfClosed();</span>
    try {
<span class="fc" id="L273">      char[] buffer = new char[length];</span>
<span class="fc" id="L274">      int charsRead = reader.read(buffer);</span>
<span class="fc" id="L275">      checkLength(charsRead, length);</span>
<span class="fc" id="L276">      String str = new String(buffer);</span>
<span class="fc" id="L277">      setObject(parameterIndex, str, DatabricksTypeUtil.STRING);</span>
<span class="nc" id="L278">    } catch (IOException e) {</span>
<span class="nc" id="L279">      String errorMessage = &quot;Error reading from the Reader&quot;;</span>
<span class="nc" id="L280">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L281">      throw new DatabricksSQLException(errorMessage, e);</span>
<span class="fc" id="L282">    }</span>
<span class="fc" id="L283">  }</span>

  @Override
  public void setRef(int parameterIndex, Ref x) throws SQLException {
<span class="fc" id="L287">    LOGGER.debug(&quot;public void setRef(int parameterIndex, Ref x)&quot;);</span>
<span class="fc" id="L288">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setRef(int parameterIndex, Ref x)&quot;);
  }

  @Override
  public void setBlob(int parameterIndex, Blob x) throws SQLException {
<span class="fc" id="L294">    LOGGER.debug(&quot;public void setBlob(int parameterIndex, Blob x)&quot;);</span>
<span class="fc" id="L295">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setBlob(int parameterIndex, Blob x)&quot;);
  }

  @Override
  public void setClob(int parameterIndex, Clob x) throws SQLException {
<span class="fc" id="L301">    LOGGER.debug(&quot;public void setClob(int parameterIndex, Clob x)&quot;);</span>
<span class="fc" id="L302">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setClob(int parameterIndex, Clob x)&quot;);
  }

  @Override
  public void setArray(int parameterIndex, Array x) throws SQLException {
<span class="fc" id="L308">    LOGGER.debug(&quot;public void setArray(int parameterIndex, Array x)&quot;);</span>
<span class="fc" id="L309">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setArray(int parameterIndex, Array x)&quot;);
  }

  @Override
  public ResultSetMetaData getMetaData() throws SQLException {
<span class="nc" id="L315">    LOGGER.debug(&quot;public ResultSetMetaData getMetaData()&quot;);</span>
<span class="nc" id="L316">    checkIfClosed();</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">    if (resultSet == null) {</span>
<span class="nc" id="L318">      return null;</span>
    }
<span class="nc" id="L320">    return resultSet.getMetaData();</span>
  }

  @Override
  public void setDate(int parameterIndex, Date x, Calendar cal) throws SQLException {
<span class="fc" id="L325">    LOGGER.debug(&quot;public void setDate(int parameterIndex, Date x, Calendar cal)&quot;);</span>
    // TODO[PECO-1702]: Integrate the calendar object since Simba implementation appears to be
    // incorrect - they
    // clear the calendar before using it
<span class="fc" id="L329">    checkIfClosed();</span>
<span class="fc" id="L330">    setObject(parameterIndex, x, DatabricksTypeUtil.DATE);</span>
<span class="fc" id="L331">  }</span>

  @Override
  public void setTime(int parameterIndex, Time x, Calendar cal) throws SQLException {
<span class="fc" id="L335">    LOGGER.debug(&quot;public void setTime(int parameterIndex, Time x, Calendar cal)&quot;);</span>
<span class="fc" id="L336">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setTime(int parameterIndex, Time x, Calendar cal)&quot;);
  }

  @Override
  public void setTimestamp(int parameterIndex, Timestamp x, Calendar cal) throws SQLException {
<span class="fc" id="L342">    LOGGER.debug(&quot;public void setTimestamp(int parameterIndex, Timestamp x, Calendar cal)&quot;);</span>
<span class="fc" id="L343">    checkIfClosed();</span>
<span class="fc" id="L344">    TimeZone originalTimeZone = TimeZone.getDefault();</span>
<span class="fc" id="L345">    TimeZone.setDefault(cal.getTimeZone());</span>
<span class="fc" id="L346">    x = new Timestamp(x.getTime());</span>
<span class="fc" id="L347">    TimeZone.setDefault(originalTimeZone);</span>
<span class="fc" id="L348">    setObject(parameterIndex, x, DatabricksTypeUtil.TIMESTAMP);</span>
<span class="fc" id="L349">  }</span>

  @Override
  public void setNull(int parameterIndex, int sqlType, String typeName) throws SQLException {
<span class="nc" id="L353">    LOGGER.debug(&quot;public void setNull(int parameterIndex, int sqlType, String typeName)&quot;);</span>
<span class="nc" id="L354">    setObject(parameterIndex, null, sqlType);</span>
<span class="nc" id="L355">  }</span>

  @Override
  public void setURL(int parameterIndex, URL x) throws SQLException {
<span class="fc" id="L359">    LOGGER.debug(&quot;public void setURL(int parameterIndex, URL x)&quot;);</span>
<span class="fc" id="L360">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setURL(int parameterIndex, URL x)&quot;);
  }

  @Override
  public ParameterMetaData getParameterMetaData() throws SQLException {
<span class="nc" id="L366">    LOGGER.debug(&quot;public ParameterMetaData getParameterMetaData()&quot;);</span>
<span class="nc" id="L367">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - getParameterMetaData()&quot;);
  }

  @Override
  public void setRowId(int parameterIndex, RowId x) throws SQLException {
<span class="fc" id="L373">    LOGGER.debug(&quot;public void setRowId(int parameterIndex, RowId x)&quot;);</span>
<span class="fc" id="L374">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setRowId(int parameterIndex, RowId x)&quot;);
  }

  @Override
  public void setNString(int parameterIndex, String value) throws SQLException {
<span class="fc" id="L380">    LOGGER.debug(&quot;public void setNString(int parameterIndex, String value)&quot;);</span>
<span class="fc" id="L381">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setNString(int parameterIndex, String value)&quot;);
  }

  @Override
  public void setNCharacterStream(int parameterIndex, Reader value, long length)
      throws SQLException {
<span class="fc" id="L388">    LOGGER.debug(&quot;public void setNCharacterStream(int parameterIndex, Reader value, long length)&quot;);</span>
<span class="fc" id="L389">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setNCharacterStream(int parameterIndex, Reader value, long length)&quot;);
  }

  @Override
  public void setNClob(int parameterIndex, NClob value) throws SQLException {
<span class="fc" id="L395">    LOGGER.debug(&quot;public void setNClob(int parameterIndex, NClob value)&quot;);</span>
<span class="fc" id="L396">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setNClob(int parameterIndex, NClob value)&quot;);
  }

  @Override
  public void setClob(int parameterIndex, Reader reader, long length) throws SQLException {
<span class="fc" id="L402">    LOGGER.debug(&quot;public void setClob(int parameterIndex, Reader reader, long length)&quot;);</span>
<span class="fc" id="L403">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setClob(int parameterIndex, Reader reader, long length)&quot;);
  }

  @Override
  public void setBlob(int parameterIndex, InputStream inputStream, long length)
      throws SQLException {
<span class="fc" id="L410">    LOGGER.debug(&quot;public void setBlob(int parameterIndex, InputStream inputStream, long length)&quot;);</span>
<span class="fc" id="L411">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setBlob(int parameterIndex, InputStream inputStream, long length)&quot;);
  }

  @Override
  public void setNClob(int parameterIndex, Reader reader, long length) throws SQLException {
<span class="fc" id="L417">    LOGGER.debug(&quot;public void setNClob(int parameterIndex, Reader reader, long length)&quot;);</span>
<span class="fc" id="L418">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setNClob(int parameterIndex, Reader reader, long length)&quot;);
  }

  @Override
  public void setSQLXML(int parameterIndex, SQLXML xmlObject) throws SQLException {
<span class="fc" id="L424">    LOGGER.debug(&quot;public void setSQLXML(int parameterIndex, SQLXML xmlObject)&quot;);</span>
<span class="fc" id="L425">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setSQLXML(int parameterIndex, SQLXML xmlObject)&quot;);
  }

  @Override
  public void setObject(int parameterIndex, Object x, int targetSqlType, int scaleOrLength)
      throws SQLException {
<span class="nc" id="L432">    LOGGER.debug(</span>
        &quot;public void setObject(int parameterIndex, Object x, int targetSqlType, int scaleOrLength)&quot;);
<span class="nc" id="L434">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setCharacterStream(int parameterIndex, Reader reader)&quot;);
  }

  @Override
  public void setAsciiStream(int parameterIndex, InputStream x, long length) throws SQLException {
<span class="fc" id="L440">    LOGGER.debug(&quot;public void setAsciiStream(int parameterIndex, InputStream x, long length)&quot;);</span>
<span class="fc" id="L441">    checkIfClosed();</span>
    try {
<span class="fc" id="L443">      ByteArrayOutputStream buffer = new ByteArrayOutputStream();</span>
      int nRead;
<span class="fc" id="L445">      byte[] chunk =</span>
          new byte[CHUNK_SIZE]; // read the stream in 8KB chunks since an int sized array may be
      // insufficient
      // to store the entire stream
<span class="fc" id="L449">      long bytesRead = 0;</span>
<span class="pc bpc" id="L450" title="1 of 4 branches missed.">      while (bytesRead &lt; length &amp;&amp; (nRead = x.read(chunk)) != -1) {</span>
<span class="fc" id="L451">        buffer.write(chunk, 0, nRead);</span>
<span class="fc" id="L452">        bytesRead += nRead;</span>
      }
<span class="fc" id="L454">      checkLength(bytesRead, length);</span>
<span class="fc" id="L455">      String asciiString = new String(buffer.toByteArray(), StandardCharsets.US_ASCII);</span>
<span class="fc" id="L456">      setObject(parameterIndex, asciiString, DatabricksTypeUtil.STRING);</span>
<span class="nc" id="L457">    } catch (IOException e) {</span>
<span class="nc" id="L458">      String errorMessage = &quot;Error reading from the InputStream&quot;;</span>
<span class="nc" id="L459">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L460">      throw new DatabricksSQLException(errorMessage, e);</span>
<span class="fc" id="L461">    }</span>
<span class="fc" id="L462">  }</span>

  @Override
  public void setBinaryStream(int parameterIndex, InputStream x, long length) throws SQLException {
<span class="fc" id="L466">    LOGGER.debug(&quot;public void setBinaryStream(int parameterIndex, InputStream x, long length)&quot;);</span>
<span class="fc" id="L467">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setBinaryStream(int parameterIndex, InputStream x, long length)&quot;);
  }

  public void setCharacterStream(int parameterIndex, Reader reader, long length)
      throws SQLException {
<span class="fc" id="L473">    LOGGER.debug(&quot;public void setCharacterStream(int parameterIndex, Reader reader, long length)&quot;);</span>
<span class="fc" id="L474">    checkIfClosed();</span>
    try {
<span class="fc" id="L476">      StringBuilder buffer = new StringBuilder();</span>
      int nRead;
<span class="fc" id="L478">      char[] chunk =</span>
          new char[CHUNK_SIZE]; // read the stream in 8KB chunks since an int sized array may be
      // insufficient
      // to store the entire stream
<span class="fc" id="L482">      long charsRead = 0;</span>
<span class="pc bpc" id="L483" title="1 of 4 branches missed.">      while (charsRead &lt; length &amp;&amp; (nRead = reader.read(chunk)) != -1) {</span>
<span class="fc" id="L484">        buffer.append(chunk, 0, nRead);</span>
<span class="fc" id="L485">        charsRead += nRead;</span>
      }
<span class="fc" id="L487">      checkLength(charsRead, length);</span>
<span class="fc" id="L488">      String characterString = buffer.toString();</span>
<span class="fc" id="L489">      setObject(parameterIndex, characterString, DatabricksTypeUtil.STRING);</span>
<span class="nc" id="L490">    } catch (IOException e) {</span>
<span class="nc" id="L491">      String errorMessage = &quot;Error reading from the Reader&quot;;</span>
<span class="nc" id="L492">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L493">      throw new DatabricksSQLException(errorMessage, e);</span>
<span class="fc" id="L494">    }</span>
<span class="fc" id="L495">  }</span>

  @Override
  public void setAsciiStream(int parameterIndex, InputStream x) throws SQLException {
<span class="fc" id="L499">    LOGGER.debug(&quot;public void setAsciiStream(int parameterIndex, InputStream x)&quot;);</span>
<span class="fc" id="L500">    checkIfClosed();</span>
    try {
<span class="fc" id="L502">      ByteArrayOutputStream buffer = new ByteArrayOutputStream();</span>
      int nRead;
<span class="fc" id="L504">      byte[] chunk = new byte[CHUNK_SIZE]; // read the stream in 8KB chunks</span>
<span class="fc bfc" id="L505" title="All 2 branches covered.">      while ((nRead = x.read(chunk)) != -1) {</span>
<span class="fc" id="L506">        buffer.write(chunk, 0, nRead);</span>
      }
<span class="fc" id="L508">      String asciiString = new String(buffer.toByteArray(), StandardCharsets.US_ASCII);</span>
<span class="fc" id="L509">      setObject(parameterIndex, asciiString, DatabricksTypeUtil.STRING);</span>
<span class="nc" id="L510">    } catch (IOException e) {</span>
<span class="nc" id="L511">      String errorMessage = &quot;Error reading from the InputStream&quot;;</span>
<span class="nc" id="L512">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L513">      throw new DatabricksSQLException(errorMessage, e);</span>
<span class="fc" id="L514">    }</span>
<span class="fc" id="L515">  }</span>

  @Override
  public void setBinaryStream(int parameterIndex, InputStream x) throws SQLException {
<span class="fc" id="L519">    LOGGER.debug(&quot;public void setBinaryStream(int parameterIndex, InputStream x)&quot;);</span>
<span class="fc" id="L520">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setBinaryStream(int parameterIndex, InputStream x)&quot;);
  }

  @Override
  public void setCharacterStream(int parameterIndex, Reader reader) throws SQLException {
<span class="fc" id="L526">    LOGGER.debug(&quot;public void setCharacterStream(int parameterIndex, Reader reader)&quot;);</span>
<span class="fc" id="L527">    checkIfClosed();</span>
    try {
<span class="fc" id="L529">      StringBuilder buffer = new StringBuilder();</span>
      int nRead;
<span class="fc" id="L531">      char[] chunk = new char[CHUNK_SIZE]; // read the stream in 8KB chunks</span>
<span class="fc bfc" id="L532" title="All 2 branches covered.">      while ((nRead = reader.read(chunk)) != -1) {</span>
<span class="fc" id="L533">        buffer.append(chunk, 0, nRead);</span>
      }
<span class="fc" id="L535">      String characterString = buffer.toString();</span>
<span class="fc" id="L536">      setObject(parameterIndex, characterString, DatabricksTypeUtil.STRING);</span>
<span class="nc" id="L537">    } catch (IOException e) {</span>
<span class="nc" id="L538">      String errorMessage = &quot;Error reading from the Reader&quot;;</span>
<span class="nc" id="L539">      LOGGER.error(errorMessage);</span>
<span class="nc" id="L540">      throw new DatabricksSQLException(errorMessage, e);</span>
<span class="fc" id="L541">    }</span>
<span class="fc" id="L542">  }</span>

  @Override
  public void setNCharacterStream(int parameterIndex, Reader value) throws SQLException {
<span class="fc" id="L546">    LOGGER.debug(&quot;public void setNCharacterStream(int parameterIndex, Reader value)&quot;);</span>
<span class="fc" id="L547">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setNCharacterStream(int parameterIndex, Reader value)&quot;);
  }

  @Override
  public void setClob(int parameterIndex, Reader reader) throws SQLException {
<span class="fc" id="L553">    LOGGER.debug(&quot;public void setClob(int parameterIndex, Reader reader)&quot;);</span>
<span class="fc" id="L554">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setClob(int parameterIndex, Reader reader)&quot;);
  }

  @Override
  public void setBlob(int parameterIndex, InputStream inputStream) throws SQLException {
<span class="fc" id="L560">    LOGGER.debug(&quot;public void setBlob(int parameterIndex, InputStream inputStream)&quot;);</span>
<span class="fc" id="L561">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setBlob(int parameterIndex, InputStream inputStream)&quot;);
  }

  @Override
  public void setNClob(int parameterIndex, Reader reader) throws SQLException {
<span class="fc" id="L567">    LOGGER.debug(&quot;public void setNClob(int parameterIndex, Reader reader)&quot;);</span>
<span class="fc" id="L568">    throw new UnsupportedOperationException(</span>
        &quot;Not implemented in DatabricksPreparedStatement - setNClob(int parameterIndex, Reader reader)&quot;);
  }

  @Override
  public int executeUpdate(String sql) throws SQLException {
<span class="fc" id="L574">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public boolean execute(String sql) throws SQLException {
<span class="nc" id="L579">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public ResultSet executeQuery(String sql) throws SQLException {
<span class="nc" id="L584">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public int executeUpdate(String sql, int autoGeneratedKeys) throws SQLException {
<span class="nc" id="L589">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public int executeUpdate(String sql, int[] columnIndexes) throws SQLException {
<span class="fc" id="L594">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public int executeUpdate(String sql, String[] columnNames) throws SQLException {
<span class="fc" id="L599">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public boolean execute(String sql, int autoGeneratedKeys) throws SQLException {
<span class="fc" id="L604">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public boolean execute(String sql, int[] columnIndexes) throws SQLException {
<span class="fc" id="L609">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }

  @Override
  public boolean execute(String sql, String[] columnNames) throws SQLException {
<span class="fc" id="L614">    throw new DatabricksSQLException(&quot;Method not supported in PreparedStatement&quot;);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>